;;;;;
title: ArchLinux64 on the X200: A Field Report
tags: Hardware, Linux
date: 2008-12-10 19:39:06
format: html
;;;;;
As I mentioned before, I have been hankering for a nice, shiny new ultraportable for almost a year and Christmas came early in 2008. I <a href="http://blog.kingcons.io/posts/Lusting-for-a-Laptop-Lenovo-the-Liberator.html">settled on a Lenovo Thinkpad X200</a> (formerly IBM) for a number of reasons.<br><br>1) It has a dock. I really wanted something with a dock since I'll be commuting with this puppy everyday for a while.<br><br>2) It weighs under 4 lbs, under 5 in the laptop bag with a power cord, and gets over 6 hours of battery life under most use scenarios, sometimes as much as 9 hours.<br><br>3) It's relatively affordable compared to similar ultraportables and I'm a big Thinkpad fan. This model also avoids touchpads which I dislike and ships without an optical drive which is a plus. After all, how often do you really use your optical drive? Save on weight. Save on power. There's a DVD/RW in the dock for when you're home anyway.<br><br>I've had it since Monday and the results are in. It's a lovely, lovely little machine and any complaints I have would be directed at software rather than hardware. That's the way it should be. I had it shipped with Windows Vista Basic because there was no option to have it shipped without an OS or with Linux and having it shipped with XP meant adding the cost of XP to the purchase price. You effectively purchase Vista and XP. Ridiculous. Therefore, the first order of business was to get Vista scrubbed off and XP SP2 installed. Now, it may seem ridiculous to worry about running XP instead of Vista but I'll cut it short and just call it a personal choice rather than defend the decision. I believe there are performance and compatibility reasons to do so as well. Google around and decide for yourself.<br><br>I have an XP Pro disc but if you try to install from it the installer blue screens. There were two separate problems in my case which both needed addressing. The first being that my disc was XP SP0 and XP SP2 is required to recognize some of the hardware. The second being that even XP SP2 needs a driver added to recognize the Intel Storage Controller unless you want to fiddle with BIOS settings for the controller before and after the install. I decided the best path was to Slipstream Service Pack 2 and the requisite drivers onto my XP install disc. Slipstreaming is inserting new updates, service packs or fixes into an old installer for a given piece of software. The program I used to do it was <a href="http://www.nliteos.com/">n-lite</a>. Microsoft kindly offers a <a href="http://www.microsoft.com/downloads/details.aspx?FamilyId=049C9DBE-3B8E-4F30-8245-9E368D3CDB5A&amp;displaylang=en">free download of SP2</a> and Lenovo, of course, offers a <a href="http://www-307.ibm.com/pc/support/site.wss/migr-70477.html">download for the Intel Storage Controller Driver</a>. I should note that you still need an original XP disc for n-lite to copy down to the hard drive and modify before you burn yourself the updated (slipstreamed) version. When slipstreaming the Intel Drivers make sure to select textmode drivers instead of PNP and select the  Intel ICH9M-E/M SATA AHCI Controller as the device to support. That about does it for Windows. Afterwards it's just the normal grab all the drivers from Lenovo runaround.<br><br>Linux has proven to be a bit more interesting. I used gparted on a LiveCD to shrink Windows' NTFS partition to 30GB of the 160GB drive in the laptop. Then I fired up the latest ArchLinux64 CD to install that. Afterwards I found that neither the ethernet card nor the wireless card in the laptop was recognized by the old kernel version. My solution was to grab my trusty USB Flash Drive and another PC, head to mirrors.unixheads.org (my Arch repo mirror of choice) and follow the links down to the most recent x86_64 kernel package. I downloaded the package onto the Flash Drive and then installed it with pacman -U, hooked it to a wire and grabbed the iwlwifi-5000-ucode package and added iwlagn to the modules array in /etc/rc.conf to enable wireless. Goodbye, networking problems.<br><br>I had stated that I'd be making a dual RedLinux v.014 release in the near future on i686 and x86_64. Apparently I didn't do my homework though as I found that the flashplugin and virtualbox-ose packages are only available on i686. Granted, flashplugin for x86_64 is in testing as Adobe <a href="http://lwn.net/Articles/307466/"><em>finally released a 64-bit alpha</em></a> for Linux recently. They've been dragging their feet on 64-bit Linux support for years...so tentatively go Adobe. That said, it could be a while before that moves from testing to extra. Apparently <a href="http://bbs.archlinux.org/viewtopic.php?pid=458790">there might be legal issues</a>. While <a href="http://archlinux.org/pipermail/aur-general/2008-December/thread.html">perusing the mailing lists</a> to learn more I <a href="http://archlinux.org/pipermail/aur-general/2008-December/003122.html">stumbled upon some big transitions in the ArchLinux camp</a>. There are lots of reasons this will likely end up an exciting and good thing but I'll be keeping a close eye on it. As for virtualbox-ose, I just traded it for the virtualbox_bin aur package. In the process I lost a little <a href="http://en.wikipedia.org/wiki/Free_software">software freedom</a> but I <a href="http://en.wikipedia.org/wiki/VirtualBox#Proprietary_vs._open_source">gained some features</a>. I then asked pacman to go download and install about 70 or 80 packages (2gb worth) set up a few config files and called it a day.<br><br>The next morning however, I found a few things amiss. The most serious issue for me at the moment is that when docked on the Ultrabase, Linux failes to pump audio out through the dock's headphone port making the use of external speakers a pain. There's a <a href="https://bugs.launchpad.net/archlinux/+source/alsa-driver/+bug/285834">bug filed in Launchpad</a> but I can't find anything in alsa's bugtracker because you need an account to browse it. That could surely do with a bit more openness. At any rate, I'm not sure how soon to expect a fix on that as it's surely not affecting many people so I'm keeping my eyes peeled for workarounds. There is nothing on the ALSA mailing lists either.<br><br>After that, my main concern was getting suspend working. Yes, I can hear your groans but it's not that bad. I promise. The issue was a some sort of concurrency related nastiness in the current xf86-video-intel driver that was causing problems on resume. A <a href="http://www.thinkwiki.org/wiki/Install_Ubuntu_8.10_%28Intrepid_Ibex%29_on_an_T400#Suspend.2FHibernate">nice workaround script</a> was posted here to get it to work properly by disabling one of the cores during the suspend operation. A new XServer with improved Xrandr (display hotplugging) and xf86-video-intel driver will release with Kernel 2.6.28 in January which will also conveniently fix the issue of dealing with the external monitor connected to the Ultrabase. It presently only detects it when booted up on the base and the resolution options are less than perfect. The new drivers will indeed be nice. I also got to learn a bit about <a href="http://wiki.archlinux.org/index.php/Pm-utils">pm-utils</a> and <a href="http://wiki.archlinux.org/index.php/Cpufrequtils">cpufrequtils</a> throughout all this. Both of which you should install to get the most out of your battery life. Oh, and powertop. <a href="http://www.lesswatts.org/projects/powertop/">Glorious powertop</a>. Hell, check out all of lesswatts.org while you're at it.<br><br>That's most of what I've been up to for tuning at this point. Next is probably just a little <a href="http://wiki.archlinux.org/index.php/Extra_Keyboard_Keys_in_Xorg">xmodmap</a> and /etc/sudoers magic to get a few of these functions keys doing what I want. Then I'll probably just wait on alsa, kernel and xorg/xf86-video-intel updates. I'll also probably end up using lxrandr to play with the Xrandr settings when the new release happens. The other fun thing I learned in all of this is just how well loved Thinkpads are and a few signs of their support among linux users through things like the <a href="http://ubuntuforums.org/showthread.php?t=907936&amp;highlight=x200">Ubuntu X200 Owner's Thread</a> and the <a href="http://www.nabble.com/Linux-Thinkpad-f13633.html">linux-thinkpad mailing list</a> with their <a href="http://www.nabble.com/X200-Battery-Life-td20188937.html">discussion on maximizing battery life</a>.<br><br>For now, I'm very happy with the new machine and probably will continue to tweak settings for a while. Turning knobs is fun after all. I also got a 1TB external drive for backup with the laptop and a Scorpius M10 mechanical keyswitch keyboard for use with the dock. The keyboard is lovely except for some spacebar sticking so I'm filling out a form to get that replaced. Ah, the joys of computing.
